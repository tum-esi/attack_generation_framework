import{S as t,i as s,s as a,e as n,t as o,k as e,c,a as i,g as r,d as l,n as u,b as f,f as d,F as h,G as m,h as g,v as p,l as v,j as S,m as w,o as b,a6 as k,r as E,w as N,u as O,M as $,Q as T,H as y,L as j,N as D,R as H,z as x,B,a4 as C,a5 as I}from"../../chunks/vendor-c052606d.js";import{T as R}from"../../chunks/index-e04611e2.js";import{T as V,x as _,n as U,a as L}from"../../chunks/requests-531e903b.js";import{s as J,a as P,b as W}from"../../chunks/store-ce76cd4a.js";/* empty css                                                       */function q(t,s,a){const n=t.slice();return n[24]=s[a],n[25]=s,n[26]=a,n}function A(t){let s,a,v,S,w,b,k,N,$,y,j,D,H,x,C,I,R,V,_,U,L,J,P,W,q,A,F,G,M,Q,K,X,Y,Z,tt,st,at="configurations"in t[0]&&z(t);return{c(){s=n("h4"),a=o("Scenario: "),v=o(t[2]),S=o(" Number of Containers: "),w=o(t[3]),b=o("."),k=e(),N=n("div"),$=n("div"),y=n("button"),j=o("Start Simulation"),D=e(),H=n("div"),x=n("button"),C=o("Stop Simulation"),I=e(),R=n("div"),V=n("button"),_=o("Reset WS Connection"),U=e(),L=n("hr"),J=e(),P=n("section"),W=n("h3"),q=o("Application Logs"),A=e(),F=n("button"),G=o("Clear Logs"),M=e(),at&&at.c(),Q=e(),K=n("br"),X=e(),Y=n("hr"),this.h()},l(n){s=c(n,"H4",{});var o=i(s);a=r(o,"Scenario: "),v=r(o,t[2]),S=r(o," Number of Containers: "),w=r(o,t[3]),b=r(o,"."),o.forEach(l),k=u(n),N=c(n,"DIV",{class:!0});var e=i(N);$=c(e,"DIV",{class:!0});var f=i($);y=c(f,"BUTTON",{class:!0});var d=i(y);j=r(d,"Start Simulation"),d.forEach(l),f.forEach(l),D=u(e),H=c(e,"DIV",{class:!0});var h=i(H);x=c(h,"BUTTON",{class:!0});var m=i(x);C=r(m,"Stop Simulation"),m.forEach(l),h.forEach(l),I=u(e),R=c(e,"DIV",{class:!0});var g=i(R);V=c(g,"BUTTON",{class:!0});var p=i(V);_=r(p,"Reset WS Connection"),p.forEach(l),g.forEach(l),e.forEach(l),U=u(n),L=c(n,"HR",{class:!0}),J=u(n),P=c(n,"SECTION",{class:!0});var E=i(P);W=c(E,"H3",{});var O=i(W);q=r(O,"Application Logs"),O.forEach(l),E.forEach(l),A=u(n),F=c(n,"BUTTON",{class:!0});var T=i(F);G=r(T,"Clear Logs"),T.forEach(l),M=u(n),at&&at.l(n),Q=u(n),K=c(n,"BR",{}),X=u(n),Y=c(n,"HR",{class:!0}),this.h()},h(){f(y,"class","w3-col w3-input w3-border"),f($,"class","w3-third"),f(x,"class","w3-col w3-input w3-border"),f(H,"class","w3-third"),f(V,"class","w3-col w3-input w3-border"),f(R,"class","w3-third"),f(N,"class","w3-row w3-section"),f(L,"class","svelte-drd2kv"),f(P,"class","page-headline"),f(F,"class","w3-col w3-input w3-border w3-button"),f(Y,"class","svelte-drd2kv")},m(n,o){d(n,s,o),h(s,a),h(s,v),h(s,S),h(s,w),h(s,b),d(n,k,o),d(n,N,o),h(N,$),h($,y),h(y,j),h(N,D),h(N,H),h(H,x),h(x,C),h(N,I),h(N,R),h(R,V),h(V,_),d(n,U,o),d(n,L,o),d(n,J,o),d(n,P,o),h(P,W),h(W,q),d(n,A,o),d(n,F,o),h(F,G),d(n,M,o),at&&at.m(n,o),d(n,Q,o),d(n,K,o),d(n,X,o),d(n,Y,o),Z=!0,tt||(st=[m(y,"click",t[10]),m(x,"click",t[11]),m(V,"click",t[12]),m(F,"click",t[5])],tt=!0)},p(t,s){(!Z||4&s)&&g(v,t[2]),(!Z||8&s)&&g(w,t[3]),"configurations"in t[0]?at?(at.p(t,s),1&s&&p(at,1)):(at=z(t),at.c(),p(at,1),at.m(Q.parentNode,Q)):at&&(B(),E(at,1,1,(()=>{at=null})),O())},i(t){Z||(p(at),Z=!0)},o(t){E(at),Z=!1},d(t){t&&l(s),t&&l(k),t&&l(N),t&&l(U),t&&l(L),t&&l(J),t&&l(P),t&&l(A),t&&l(F),t&&l(M),at&&at.d(t),t&&l(Q),t&&l(K),t&&l(X),t&&l(Y),tt=!1,T(st)}}}function z(t){let s,a,n=t[0].configurations.length>0&&F(t);return{c(){n&&n.c(),s=v()},l(t){n&&n.l(t),s=v()},m(t,o){n&&n.m(t,o),d(t,s,o),a=!0},p(t,a){t[0].configurations.length>0?n?(n.p(t,a),1&a&&p(n,1)):(n=F(t),n.c(),p(n,1),n.m(s.parentNode,s)):n&&(B(),E(n,1,1,(()=>{n=null})),O())},i(t){a||(p(n),a=!0)},o(t){E(n),a=!1},d(t){n&&n.d(t),t&&l(s)}}}function F(t){let s,a,n=t[0].configurations,o=[];for(let c=0;c<n.length;c+=1)o[c]=K(q(t,n,c));const e=t=>E(o[t],1,1,(()=>{o[t]=null}));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();s=v()},l(t){for(let s=0;s<o.length;s+=1)o[s].l(t);s=v()},m(t,n){for(let s=0;s<o.length;s+=1)o[s].m(t,n);d(t,s,n),a=!0},p(t,a){if(17&a){let c;for(n=t[0].configurations,c=0;c<n.length;c+=1){const e=q(t,n,c);o[c]?(o[c].p(e,a),p(o[c],1)):(o[c]=K(e),o[c].c(),p(o[c],1),o[c].m(s.parentNode,s))}for(B(),c=n.length;c<o.length;c+=1)e(c);O()}},i(t){if(!a){for(let t=0;t<n.length;t+=1)p(o[t]);a=!0}},o(t){o=o.filter(Boolean);for(let s=0;s<o.length;s+=1)E(o[s]);a=!1},d(t){$(o,t),t&&l(s)}}}function G(t){let s,a,n=t[26].toString()in t[4],o=n&&M(t);return{c(){o&&o.c(),s=v()},l(t){o&&o.l(t),s=v()},m(t,n){o&&o.m(t,n),d(t,s,n),a=!0},p(t,a){16&a&&(n=t[26].toString()in t[4]),n?o?(o.p(t,a),16&a&&p(o,1)):(o=M(t),o.c(),p(o,1),o.m(s.parentNode,s)):o&&(B(),E(o,1,1,(()=>{o=null})),O())},i(t){a||(p(o),a=!0)},o(t){E(o),a=!1},d(t){o&&o.d(t),t&&l(s)}}}function M(t){let s,a,n=t[4][t[26].toString()].length>0,o=n&&Q(t);return{c(){o&&o.c(),s=v()},l(t){o&&o.l(t),s=v()},m(t,n){o&&o.m(t,n),d(t,s,n),a=!0},p(t,a){16&a&&(n=t[4][t[26].toString()].length>0),n?o?(o.p(t,a),16&a&&p(o,1)):(o=Q(t),o.c(),p(o,1),o.m(s.parentNode,s)):o&&(B(),E(o,1,1,(()=>{o=null})),O())},i(t){a||(p(o),a=!0)},o(t){E(o),a=!1},d(t){o&&o.d(t),t&&l(s)}}}function Q(t){let s,a,f,m,v,O,$,T=t[24].container_info.name+"";function y(s){t[13](s,t[26])}let j={title:t[24].container_info.name,headers:Object.keys(t[4][t[26].toString()][0])};return void 0!==t[4][t[26].toString()]&&(j.data=t[4][t[26].toString()]),m=new R({props:j}),C.push((()=>I(m,"data",y))),{c(){s=n("h5"),a=o(T),f=e(),S(m.$$.fragment),O=e()},l(t){s=c(t,"H5",{});var n=i(s);a=r(n,T),n.forEach(l),f=u(t),w(m.$$.fragment,t),O=u(t)},m(t,n){d(t,s,n),h(s,a),d(t,f,n),b(m,t,n),d(t,O,n),$=!0},p(s,n){t=s,(!$||1&n)&&T!==(T=t[24].container_info.name+"")&&g(a,T);const o={};1&n&&(o.title=t[24].container_info.name),16&n&&(o.headers=Object.keys(t[4][t[26].toString()][0])),!v&&16&n&&(v=!0,o.data=t[4][t[26].toString()],k((()=>v=!1))),m.$set(o)},i(t){$||(p(m.$$.fragment,t),$=!0)},o(t){E(m.$$.fragment,t),$=!1},d(t){t&&l(s),t&&l(f),N(m,t),t&&l(O)}}}function K(t){let s,a,n=Object.keys(t[4]).length>0,o=n&&G(t);return{c(){o&&o.c(),s=v()},l(t){o&&o.l(t),s=v()},m(t,n){o&&o.m(t,n),d(t,s,n),a=!0},p(t,a){16&a&&(n=Object.keys(t[4]).length>0),n?o?(o.p(t,a),16&a&&p(o,1)):(o=G(t),o.c(),p(o,1),o.m(s.parentNode,s)):o&&(B(),E(o,1,1,(()=>{o=null})),O())},i(t){a||(p(o),a=!0)},o(t){E(o),a=!1},d(t){o&&o.d(t),t&&l(s)}}}function X(t){let s,a,g,p,v,S,w,b;return{c(){s=n("div"),a=n("div"),g=n("button"),p=o("Start Simulation"),v=e(),S=n("hr"),this.h()},l(t){s=c(t,"DIV",{class:!0});var n=i(s);a=c(n,"DIV",{class:!0});var o=i(a);g=c(o,"BUTTON",{class:!0});var e=i(g);p=r(e,"Start Simulation"),e.forEach(l),o.forEach(l),n.forEach(l),v=u(t),S=c(t,"HR",{class:!0}),this.h()},h(){f(g,"class","w3-col w3-input w3-border"),f(a,"class","w3-rest"),f(s,"class","w3-row w3-section"),f(S,"class","svelte-drd2kv")},m(n,o){d(n,s,o),h(s,a),h(a,g),h(g,p),d(n,v,o),d(n,S,o),w||(b=m(g,"click",t[8]),w=!0)},p:y,d(t){t&&l(s),t&&l(v),t&&l(S),w=!1,b()}}}function Y(t){let s,a,e,u,g,p;return{c(){s=n("div"),a=n("div"),e=n("button"),u=o("Start Simulation"),this.h()},l(t){s=c(t,"DIV",{class:!0});var n=i(s);a=c(n,"DIV",{class:!0});var o=i(a);e=c(o,"BUTTON",{class:!0});var f=i(e);u=r(f,"Start Simulation"),f.forEach(l),o.forEach(l),n.forEach(l),this.h()},h(){f(e,"class","w3-col w3-input w3-border"),f(a,"class","w3-rest"),f(s,"class","w3-row w3-section")},m(n,o){d(n,s,o),h(s,a),h(a,e),h(e,u),g||(p=m(e,"click",t[9]),g=!0)},p:y,d(t){t&&l(s),g=!1,p()}}}function Z(t){let s,a,m,g,v,k,$,T,y,H,x,C,I,R,_,U,L;a=new V({});let J="Communication"==t[1]&&A(t),P="Static"==t[1]&&X(t),W="Driving Simulation"==t[1]&&Y(t);return{c(){s=e(),S(a.$$.fragment),m=e(),g=n("hr"),v=e(),k=n("div"),$=n("h1"),T=n("b"),y=o("Simulation"),H=e(),x=n("hr"),C=e(),J&&J.c(),I=e(),P&&P.c(),R=e(),W&&W.c(),_=e(),U=n("hr"),this.h()},l(t){j('[data-svelte="svelte-1smsifb"]',document.head).forEach(l),s=u(t),w(a.$$.fragment,t),m=u(t),g=c(t,"HR",{class:!0}),v=u(t),k=c(t,"DIV",{class:!0});var n=i(k);$=c(n,"H1",{class:!0,style:!0});var o=i($);T=c(o,"B",{});var e=i(T);y=r(e,"Simulation"),e.forEach(l),o.forEach(l),n.forEach(l),H=u(t),x=c(t,"HR",{class:!0}),C=u(t),J&&J.l(t),I=u(t),P&&P.l(t),R=u(t),W&&W.l(t),_=u(t),U=c(t,"HR",{class:!0}),this.h()},h(){document.title="Simulation",f(g,"class","svelte-drd2kv"),f($,"class","w3-text-yellow"),D($,"text-shadow","1px 1px 0 #444"),f(k,"class","w3-panel w3-blue"),f(x,"class","svelte-drd2kv"),f(U,"class","svelte-drd2kv")},m(t,n){d(t,s,n),b(a,t,n),d(t,m,n),d(t,g,n),d(t,v,n),d(t,k,n),h(k,$),h($,T),h(T,y),d(t,H,n),d(t,x,n),d(t,C,n),J&&J.m(t,n),d(t,I,n),P&&P.m(t,n),d(t,R,n),W&&W.m(t,n),d(t,_,n),d(t,U,n),L=!0},p(t,[s]){"Communication"==t[1]?J?(J.p(t,s),2&s&&p(J,1)):(J=A(t),J.c(),p(J,1),J.m(I.parentNode,I)):J&&(B(),E(J,1,1,(()=>{J=null})),O()),"Static"==t[1]?P?P.p(t,s):(P=X(t),P.c(),P.m(R.parentNode,R)):P&&(P.d(1),P=null),"Driving Simulation"==t[1]?W?W.p(t,s):(W=Y(t),W.c(),W.m(_.parentNode,_)):W&&(W.d(1),W=null)},i(t){L||(p(a.$$.fragment,t),p(J),L=!0)},o(t){E(a.$$.fragment,t),E(J),L=!1},d(t){t&&l(s),N(a,t),t&&l(m),t&&l(g),t&&l(v),t&&l(k),t&&l(H),t&&l(x),t&&l(C),J&&J.d(t),t&&l(I),P&&P.d(t),t&&l(R),W&&W.d(t),t&&l(_),t&&l(U)}}}function tt(t,s,a){let n=[],o={},e="";const c=J.subscribe((t=>{n=t})),i=P.subscribe((t=>{a(0,o=t)})),r=W.subscribe((t=>{a(1,e=t)}));let l=[];H((()=>{c(),i(),r();for(let t=0;t<l.length;t++)l[t].close()}));let u="Please create and select a scenario before starting the simulation.",f=!1,d=0,h=[],m={};function g(){for(const[t,s]of Object.entries(m))a(4,m[t]=[],m)}async function p(t){if(!f)return void U.danger("please create and activate a scenario first.");"start"==t&&g(),L("/simulation/comm","POST",{command:t,configs:o},(function(t){t.data&&(U.success("simulation started."),console.log("response of simulation",t.data))}))}function v(){for(var t=0;t<l.length;t++)ws=l[t],ws.close()}l=[],x((async()=>{let t="";for(let s=0;s<n.length;s++)n[s].activated&&(a(2,u=n[s].name),f=!0,t="/api/db1/scenario_configurations/ref-"+n[s]._id);!function(t,s){_(t,(function(t){let a=JSON.parse(t.response);a.data&&a.data.length>0&&(P.set(a.data[0]),s())}))}(t,(function(){if("Communication"==o.type){"configurations"in o&&a(3,d=o.configurations.length);for(var t=0;t<d;t++){a(4,m[t.toString()]=[],m);let s="ws://localhost:8000/simulation/comm/ws/"+t.toString(),n=new WebSocket(s);n.onopen=function(){window.console.log("Successfully connected to the echo websocket server...")},n.onmessage=function(t){let s=JSON.parse(t.data);console.log(s,"printing JSON now");let n=s.client_index,o=JSON.parse(s.data);"status"in o?h[n]=o.status:a(4,m[n]=[...m[n],o],m)},l.push(n)}}}))}));return[o,e,u,d,m,g,p,v,function(){L("/simulation/static","POST",{configs:o},(function(t){t.data&&(U.success("simulation started."),console.log("response of simulation",t.data))}))},function(){L("/simulation/static","POST",{configs:o},(function(t){t.data&&(U.success("simulation started."),console.log("response of simulation",t.data))}))},()=>p("start"),()=>p("stop"),()=>v(),function(s,n){t.$$.not_equal(m[n.toString()],s)&&(m[n.toString()]=s,a(4,m))}]}export default class extends t{constructor(t){super(),s(this,t,tt,Z,a,{})}}
