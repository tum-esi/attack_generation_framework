import{S as t,i as s,s as a,l as o,f as e,v as n,j as l,k as r,m as c,n as i,o as f,a5 as u,r as d,w as g,d as h,u as m,M as p,e as w,t as v,L as b,c as S,a as k,g as $,b as E,N,F as O,G as j,h as T,Q as x,R as y,z as _,B,a3 as H,a4 as R}from"../../chunks/vendor-5cf7a4b5.js";import{T as C}from"../../chunks/index-a1695e4a.js";import{T as D,n as I,a as L}from"../../chunks/requests-f597ce78.js";import{s as V,a as J}from"../../chunks/store-f8ef346b.js";function U(t,s,a){const o=t.slice();return o[17]=s[a],o[18]=s,o[19]=a,o}function q(t){let s,a,l=t[0].configurations.length>0&&A(t);return{c(){l&&l.c(),s=o()},l(t){l&&l.l(t),s=o()},m(t,o){l&&l.m(t,o),e(t,s,o),a=!0},p(t,a){t[0].configurations.length>0?l?(l.p(t,a),1&a&&n(l,1)):(l=A(t),l.c(),n(l,1),l.m(s.parentNode,s)):l&&(B(),d(l,1,1,(()=>{l=null})),m())},i(t){a||(n(l),a=!0)},o(t){d(l),a=!1},d(t){l&&l.d(t),t&&h(s)}}}function A(t){let s,a,l=t[0].configurations,r=[];for(let o=0;o<l.length;o+=1)r[o]=z(U(t,l,o));const c=t=>d(r[t],1,1,(()=>{r[t]=null}));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();s=o()},l(t){for(let s=0;s<r.length;s+=1)r[s].l(t);s=o()},m(t,o){for(let s=0;s<r.length;s+=1)r[s].m(t,o);e(t,s,o),a=!0},p(t,a){if(9&a){let o;for(l=t[0].configurations,o=0;o<l.length;o+=1){const e=U(t,l,o);r[o]?(r[o].p(e,a),n(r[o],1)):(r[o]=z(e),r[o].c(),n(r[o],1),r[o].m(s.parentNode,s))}for(B(),o=l.length;o<r.length;o+=1)c(o);m()}},i(t){if(!a){for(let t=0;t<l.length;t+=1)n(r[t]);a=!0}},o(t){r=r.filter(Boolean);for(let s=0;s<r.length;s+=1)d(r[s]);a=!1},d(t){p(r,t),t&&h(s)}}}function P(t){let s,a,o,m;function p(s){t[8](s,t[19])}let w={title:t[17].container_info.name,headers:Object.keys(t[3][t[19]])};return void 0!==t[3][t[19]]&&(w.data=t[3][t[19]]),s=new C({props:w}),H.push((()=>R(s,"data",p))),{c(){l(s.$$.fragment),o=r()},l(t){c(s.$$.fragment,t),o=i(t)},m(t,a){f(s,t,a),e(t,o,a),m=!0},p(o,e){t=o;const n={};1&e&&(n.title=t[17].container_info.name),8&e&&(n.headers=Object.keys(t[3][t[19]])),!a&&8&e&&(a=!0,n.data=t[3][t[19]],u((()=>a=!1))),s.$set(n)},i(t){m||(n(s.$$.fragment,t),m=!0)},o(t){d(s.$$.fragment,t),m=!1},d(t){g(s,t),t&&h(o)}}}function z(t){let s,a,l=Object.keys(t[3]).length>0,r=l&&P(t);return{c(){r&&r.c(),s=o()},l(t){r&&r.l(t),s=o()},m(t,o){r&&r.m(t,o),e(t,s,o),a=!0},p(t,a){8&a&&(l=Object.keys(t[3]).length>0),l?r?(r.p(t,a),8&a&&n(r,1)):(r=P(t),r.c(),n(r,1),r.m(s.parentNode,s)):r&&(B(),d(r,1,1,(()=>{r=null})),m())},i(t){a||(n(r),a=!0)},o(t){d(r),a=!1},d(t){r&&r.d(t),t&&h(s)}}}function F(t){let s,a,o,u,p,y,_,H,R,C,I,L,V,J,U,A,P,z,F,G,M,Q,W,K,X,Y,Z,tt,st,at,ot,et,nt,lt,rt,ct,it,ft,ut,dt,gt,ht,mt,pt;a=new D({});let wt="configurations"in t[0]&&q(t);return{c(){s=r(),l(a.$$.fragment),o=r(),u=w("hr"),p=r(),y=w("div"),_=w("h1"),H=w("b"),R=v("Simulation"),C=r(),I=w("hr"),L=r(),V=w("h4"),J=v("Scenario: "),U=v(t[1]),A=v(" Number of Containers: "),P=v(t[2]),z=v("."),F=r(),G=w("div"),M=w("div"),Q=w("button"),W=v("Start Simulation"),K=r(),X=w("div"),Y=w("button"),Z=v("Stop Simulation"),tt=r(),st=w("hr"),at=r(),ot=w("section"),et=w("h3"),nt=v("Application Logs"),lt=r(),rt=w("button"),ct=v("Clear Logs"),it=r(),wt&&wt.c(),ft=r(),ut=w("br"),dt=r(),gt=w("hr"),this.h()},l(e){b('[data-svelte="svelte-1smsifb"]',document.head).forEach(h),s=i(e),c(a.$$.fragment,e),o=i(e),u=S(e,"HR",{class:!0}),p=i(e),y=S(e,"DIV",{class:!0});var n=k(y);_=S(n,"H1",{class:!0,style:!0});var l=k(_);H=S(l,"B",{});var r=k(H);R=$(r,"Simulation"),r.forEach(h),l.forEach(h),n.forEach(h),C=i(e),I=S(e,"HR",{class:!0}),L=i(e),V=S(e,"H4",{});var f=k(V);J=$(f,"Scenario: "),U=$(f,t[1]),A=$(f," Number of Containers: "),P=$(f,t[2]),z=$(f,"."),f.forEach(h),F=i(e),G=S(e,"DIV",{class:!0});var d=k(G);M=S(d,"DIV",{class:!0});var g=k(M);Q=S(g,"BUTTON",{class:!0});var m=k(Q);W=$(m,"Start Simulation"),m.forEach(h),g.forEach(h),K=i(d),X=S(d,"DIV",{class:!0});var w=k(X);Y=S(w,"BUTTON",{class:!0});var v=k(Y);Z=$(v,"Stop Simulation"),v.forEach(h),w.forEach(h),d.forEach(h),tt=i(e),st=S(e,"HR",{class:!0}),at=i(e),ot=S(e,"SECTION",{class:!0});var E=k(ot);et=S(E,"H3",{});var N=k(et);nt=$(N,"Application Logs"),N.forEach(h),E.forEach(h),lt=i(e),rt=S(e,"BUTTON",{class:!0});var O=k(rt);ct=$(O,"Clear Logs"),O.forEach(h),it=i(e),wt&&wt.l(e),ft=i(e),ut=S(e,"BR",{}),dt=i(e),gt=S(e,"HR",{class:!0}),this.h()},h(){document.title="Simulation",E(u,"class","svelte-drd2kv"),E(_,"class","w3-text-yellow"),N(_,"text-shadow","1px 1px 0 #444"),E(y,"class","w3-panel w3-blue"),E(I,"class","svelte-drd2kv"),E(Q,"class","w3-col w3-input w3-border w3-margin"),E(M,"class","w3-half"),E(Y,"class","w3-col w3-input w3-border w3-margin"),E(X,"class","w3-half"),E(G,"class","w3-row w3-section"),E(st,"class","svelte-drd2kv"),E(ot,"class","page-headline"),E(rt,"class","w3-col w3-input w3-border w3-button"),E(gt,"class","svelte-drd2kv")},m(n,l){e(n,s,l),f(a,n,l),e(n,o,l),e(n,u,l),e(n,p,l),e(n,y,l),O(y,_),O(_,H),O(H,R),e(n,C,l),e(n,I,l),e(n,L,l),e(n,V,l),O(V,J),O(V,U),O(V,A),O(V,P),O(V,z),e(n,F,l),e(n,G,l),O(G,M),O(M,Q),O(Q,W),O(G,K),O(G,X),O(X,Y),O(Y,Z),e(n,tt,l),e(n,st,l),e(n,at,l),e(n,ot,l),O(ot,et),O(et,nt),e(n,lt,l),e(n,rt,l),O(rt,ct),e(n,it,l),wt&&wt.m(n,l),e(n,ft,l),e(n,ut,l),e(n,dt,l),e(n,gt,l),ht=!0,mt||(pt=[j(Q,"click",t[6]),j(Y,"click",t[7]),j(rt,"click",t[4])],mt=!0)},p(t,[s]){(!ht||2&s)&&T(U,t[1]),(!ht||4&s)&&T(P,t[2]),"configurations"in t[0]?wt?(wt.p(t,s),1&s&&n(wt,1)):(wt=q(t),wt.c(),n(wt,1),wt.m(ft.parentNode,ft)):wt&&(B(),d(wt,1,1,(()=>{wt=null})),m())},i(t){ht||(n(a.$$.fragment,t),n(wt),ht=!0)},o(t){d(a.$$.fragment,t),d(wt),ht=!1},d(t){t&&h(s),g(a,t),t&&h(o),t&&h(u),t&&h(p),t&&h(y),t&&h(C),t&&h(I),t&&h(L),t&&h(V),t&&h(F),t&&h(G),t&&h(tt),t&&h(st),t&&h(at),t&&h(ot),t&&h(lt),t&&h(rt),t&&h(it),wt&&wt.d(t),t&&h(ft),t&&h(ut),t&&h(dt),t&&h(gt),mt=!1,x(pt)}}}function G(t,s,a){let o=[],e={};const n=V.subscribe((t=>{o=t})),l=J.subscribe((t=>{a(0,e=t)}));let r=[];y((()=>{n(),l();for(let t=0;t<r.length;t++)r[t].close()}));let c="Please create and select a scenario before starting the simulation.",i=!1,f=0,u=[],d={};function g(){for(const[t,s]of Object.entries(d))a(3,d[t]=[],d)}async function h(t){if(!i)return void I.danger("please create and activate a scenario first.");g(),console.log("start or stop simulation"),L("/simulation","POST",{command:t,configs:e},(function(t){t.data&&console.log("response of start simulation",t.data)}))}_((async()=>{for(let s=0;s<o.length;s++)o[s].activated&&(a(1,c=o[s].name),i=!0,a(3,d[s.toString()]=[],d));"configurations"in e&&a(2,f=e.configurations.length),console.log("scenarios",o),console.log("scenario_configurations",e),r=[];for(var t=0;t<f;t++){let s=e.configurations[t].container_info.name,a=e.configurations[t].container_info.ports.split(",")[0].split("/")[0];console.log("sending to controller websocket: index",t,"name",s,"port",a);let o="ws://localhost:8000/simulation/ws/"+s+"/"+a+"/"+t.toString();console.log("ws url:",o);let n=new WebSocket(o);n.onopen=function(){window.console.log("Successfully connected to the echo websocket server...")},n.onmessage=function(t){window.console.log(t,"received ws message");let s=JSON.parse(t.data);console.log(s,"printing JSON now");let a=s.client_index,o=JSON.parse(s.data);console.log("containerData",o),"status"in o&&(u[a]=o.status),"data"in o&&d[a].push(o.data),console.log(d,"ws_data printing")},r.push(n)}}));return[e,c,f,d,g,h,()=>h("start"),()=>h("stop"),function(s,o){t.$$.not_equal(d[o],s)&&(d[o]=s,a(3,d))}]}export default class extends t{constructor(t){super(),s(this,t,G,F,a,{})}}
