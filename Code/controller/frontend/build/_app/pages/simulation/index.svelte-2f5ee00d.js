import{S as s,i as t,s as a,l as o,f as e,v as n,j as l,k as r,m as c,n as i,o as f,a5 as u,r as g,w as d,d as h,u as m,M as p,e as w,t as v,L as b,c as S,a as k,g as $,b as E,N,F as O,G as j,h as T,Q as x,R as y,z as _,B,a3 as H,a4 as R}from"../../chunks/vendor-5cf7a4b5.js";import{T as C}from"../../chunks/index-a1695e4a.js";import{T as D,n as I,a as L}from"../../chunks/requests-f597ce78.js";import{s as V,a as J}from"../../chunks/store-f8ef346b.js";function U(s,t,a){const o=s.slice();return o[17]=t[a],o[18]=t,o[19]=a,o}function q(s){let t,a,l=s[0].configurations.length>0&&A(s);return{c(){l&&l.c(),t=o()},l(s){l&&l.l(s),t=o()},m(s,o){l&&l.m(s,o),e(s,t,o),a=!0},p(s,a){s[0].configurations.length>0?l?(l.p(s,a),1&a&&n(l,1)):(l=A(s),l.c(),n(l,1),l.m(t.parentNode,t)):l&&(B(),g(l,1,1,(()=>{l=null})),m())},i(s){a||(n(l),a=!0)},o(s){g(l),a=!1},d(s){l&&l.d(s),s&&h(t)}}}function A(s){let t,a,l=s[0].configurations,r=[];for(let o=0;o<l.length;o+=1)r[o]=z(U(s,l,o));const c=s=>g(r[s],1,1,(()=>{r[s]=null}));return{c(){for(let s=0;s<r.length;s+=1)r[s].c();t=o()},l(s){for(let t=0;t<r.length;t+=1)r[t].l(s);t=o()},m(s,o){for(let t=0;t<r.length;t+=1)r[t].m(s,o);e(s,t,o),a=!0},p(s,a){if(9&a){let o;for(l=s[0].configurations,o=0;o<l.length;o+=1){const e=U(s,l,o);r[o]?(r[o].p(e,a),n(r[o],1)):(r[o]=z(e),r[o].c(),n(r[o],1),r[o].m(t.parentNode,t))}for(B(),o=l.length;o<r.length;o+=1)c(o);m()}},i(s){if(!a){for(let s=0;s<l.length;s+=1)n(r[s]);a=!0}},o(s){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)g(r[t]);a=!1},d(s){p(r,s),s&&h(t)}}}function P(s){let t,a,o,m;function p(t){s[8](t,s[19])}let w={title:s[17].container_info.name,headers:Object.keys(s[3][s[19]])};return void 0!==s[3][s[19]]&&(w.data=s[3][s[19]]),t=new C({props:w}),H.push((()=>R(t,"data",p))),{c(){l(t.$$.fragment),o=r()},l(s){c(t.$$.fragment,s),o=i(s)},m(s,a){f(t,s,a),e(s,o,a),m=!0},p(o,e){s=o;const n={};1&e&&(n.title=s[17].container_info.name),8&e&&(n.headers=Object.keys(s[3][s[19]])),!a&&8&e&&(a=!0,n.data=s[3][s[19]],u((()=>a=!1))),t.$set(n)},i(s){m||(n(t.$$.fragment,s),m=!0)},o(s){g(t.$$.fragment,s),m=!1},d(s){d(t,s),s&&h(o)}}}function z(s){let t,a,l=Object.keys(s[3]).length>0,r=l&&P(s);return{c(){r&&r.c(),t=o()},l(s){r&&r.l(s),t=o()},m(s,o){r&&r.m(s,o),e(s,t,o),a=!0},p(s,a){8&a&&(l=Object.keys(s[3]).length>0),l?r?(r.p(s,a),8&a&&n(r,1)):(r=P(s),r.c(),n(r,1),r.m(t.parentNode,t)):r&&(B(),g(r,1,1,(()=>{r=null})),m())},i(s){a||(n(r),a=!0)},o(s){g(r),a=!1},d(s){r&&r.d(s),s&&h(t)}}}function F(s){let t,a,o,u,p,y,_,H,R,C,I,L,V,J,U,A,P,z,F,G,M,Q,W,K,X,Y,Z,ss,ts,as,os,es,ns,ls,rs,cs,is,fs,us,gs,ds,hs,ms,ps;a=new D({});let ws="configurations"in s[0]&&q(s);return{c(){t=r(),l(a.$$.fragment),o=r(),u=w("hr"),p=r(),y=w("div"),_=w("h1"),H=w("b"),R=v("Simulation"),C=r(),I=w("hr"),L=r(),V=w("h4"),J=v("Scenario: "),U=v(s[1]),A=v(" Number of Containers: "),P=v(s[2]),z=v("."),F=r(),G=w("div"),M=w("div"),Q=w("button"),W=v("Start Simulation"),K=r(),X=w("div"),Y=w("button"),Z=v("Stop Simulation"),ss=r(),ts=w("hr"),as=r(),os=w("section"),es=w("h3"),ns=v("Application Logs"),ls=r(),rs=w("button"),cs=v("Clear Logs"),is=r(),ws&&ws.c(),fs=r(),us=w("br"),gs=r(),ds=w("hr"),this.h()},l(e){b('[data-svelte="svelte-1smsifb"]',document.head).forEach(h),t=i(e),c(a.$$.fragment,e),o=i(e),u=S(e,"HR",{class:!0}),p=i(e),y=S(e,"DIV",{class:!0});var n=k(y);_=S(n,"H1",{class:!0,style:!0});var l=k(_);H=S(l,"B",{});var r=k(H);R=$(r,"Simulation"),r.forEach(h),l.forEach(h),n.forEach(h),C=i(e),I=S(e,"HR",{class:!0}),L=i(e),V=S(e,"H4",{});var f=k(V);J=$(f,"Scenario: "),U=$(f,s[1]),A=$(f," Number of Containers: "),P=$(f,s[2]),z=$(f,"."),f.forEach(h),F=i(e),G=S(e,"DIV",{class:!0});var g=k(G);M=S(g,"DIV",{class:!0});var d=k(M);Q=S(d,"BUTTON",{class:!0});var m=k(Q);W=$(m,"Start Simulation"),m.forEach(h),d.forEach(h),K=i(g),X=S(g,"DIV",{class:!0});var w=k(X);Y=S(w,"BUTTON",{class:!0});var v=k(Y);Z=$(v,"Stop Simulation"),v.forEach(h),w.forEach(h),g.forEach(h),ss=i(e),ts=S(e,"HR",{class:!0}),as=i(e),os=S(e,"SECTION",{class:!0});var E=k(os);es=S(E,"H3",{});var N=k(es);ns=$(N,"Application Logs"),N.forEach(h),E.forEach(h),ls=i(e),rs=S(e,"BUTTON",{class:!0});var O=k(rs);cs=$(O,"Clear Logs"),O.forEach(h),is=i(e),ws&&ws.l(e),fs=i(e),us=S(e,"BR",{}),gs=i(e),ds=S(e,"HR",{class:!0}),this.h()},h(){document.title="Simulation",E(u,"class","svelte-drd2kv"),E(_,"class","w3-text-yellow"),N(_,"text-shadow","1px 1px 0 #444"),E(y,"class","w3-panel w3-blue"),E(I,"class","svelte-drd2kv"),E(Q,"class","w3-col w3-input w3-border w3-margin"),E(M,"class","w3-half"),E(Y,"class","w3-col w3-input w3-border w3-margin"),E(X,"class","w3-half"),E(G,"class","w3-row w3-section"),E(ts,"class","svelte-drd2kv"),E(os,"class","page-headline"),E(rs,"class","w3-col w3-input w3-border w3-button"),E(ds,"class","svelte-drd2kv")},m(n,l){e(n,t,l),f(a,n,l),e(n,o,l),e(n,u,l),e(n,p,l),e(n,y,l),O(y,_),O(_,H),O(H,R),e(n,C,l),e(n,I,l),e(n,L,l),e(n,V,l),O(V,J),O(V,U),O(V,A),O(V,P),O(V,z),e(n,F,l),e(n,G,l),O(G,M),O(M,Q),O(Q,W),O(G,K),O(G,X),O(X,Y),O(Y,Z),e(n,ss,l),e(n,ts,l),e(n,as,l),e(n,os,l),O(os,es),O(es,ns),e(n,ls,l),e(n,rs,l),O(rs,cs),e(n,is,l),ws&&ws.m(n,l),e(n,fs,l),e(n,us,l),e(n,gs,l),e(n,ds,l),hs=!0,ms||(ps=[j(Q,"click",s[6]),j(Y,"click",s[7]),j(rs,"click",s[4])],ms=!0)},p(s,[t]){(!hs||2&t)&&T(U,s[1]),(!hs||4&t)&&T(P,s[2]),"configurations"in s[0]?ws?(ws.p(s,t),1&t&&n(ws,1)):(ws=q(s),ws.c(),n(ws,1),ws.m(fs.parentNode,fs)):ws&&(B(),g(ws,1,1,(()=>{ws=null})),m())},i(s){hs||(n(a.$$.fragment,s),n(ws),hs=!0)},o(s){g(a.$$.fragment,s),g(ws),hs=!1},d(s){s&&h(t),d(a,s),s&&h(o),s&&h(u),s&&h(p),s&&h(y),s&&h(C),s&&h(I),s&&h(L),s&&h(V),s&&h(F),s&&h(G),s&&h(ss),s&&h(ts),s&&h(as),s&&h(os),s&&h(ls),s&&h(rs),s&&h(is),ws&&ws.d(s),s&&h(fs),s&&h(us),s&&h(gs),s&&h(ds),ms=!1,x(ps)}}}function G(s,t,a){let o=[],e={};const n=V.subscribe((s=>{o=s})),l=J.subscribe((s=>{a(0,e=s)}));let r=[];y((()=>{n(),l();for(let s=0;s<r.length;s++)r[s].close()}));let c="Please create and select a scenario before starting the simulation.",i=!1,f=0,u=[],g={};function d(){for(const[s,t]of Object.entries(g))a(3,g[s]=[],g)}async function h(s){if(!i)return void I.danger("please create and activate a scenario first.");d(),console.log("start or stop simulation"),L("/simulation","POST",{command:s,configs:e},(function(s){s.data&&console.log("response of start simulation",s.data)}))}_((async()=>{for(let t=0;t<o.length;t++)o[t].activated&&(a(1,c=o[t].name),i=!0);"configurations"in e&&a(2,f=e.configurations.length),console.log("scenarios",o),console.log("scenario_configurations",e),r=[];for(var s=0;s<f;s++){a(3,g[s.toString()]=[],g);let t=e.configurations[s].container_info.name,o=e.configurations[s].container_info.ports.split(",")[0].split("/")[0];console.log("sending to controller websocket: index",s,"name",t,"port",o);let n="ws://localhost:8000/simulation/ws/"+t+"/"+o+"/"+s.toString();console.log("ws url:",n);let l=new WebSocket(n);l.onopen=function(){window.console.log("Successfully connected to the echo websocket server...")},l.onmessage=function(s){window.console.log(s,"received ws message");let t=JSON.parse(s.data);console.log(t,"printing JSON now");let a=t.client_index,o=JSON.parse(t.data);g[a].push(o),console.log("containerData",o),"status"in o&&(u[a]=o.status),console.log(g,"ws_data printing")},r.push(l)}}));return[e,c,f,g,d,h,()=>h("start"),()=>h("stop"),function(t,o){s.$$.not_equal(g[o],t)&&(g[o]=t,a(3,g))}]}export default class extends s{constructor(s){super(),t(this,s,G,F,a,{})}}
