import{S as t,i as n,s as e,e as a,t as s,k as o,c as r,a as c,g as i,d as l,n as u,b as f,f as d,F as m,G as h,h as g,v as p,l as v,j as S,m as w,o as b,a6 as N,r as k,w as $,u as E,M as O,Q as y,H as T,L as j,N as x,R as C,z as H,B as _,a4 as B,a5 as R}from"../../chunks/vendor-c052606d.js";import{T as D}from"../../chunks/index-e04611e2.js";import{T as I,x as L,n as V,a as J}from"../../chunks/requests-531e903b.js";import{s as U,a as W,b as q}from"../../chunks/store-ce76cd4a.js";/* empty css                                                       */function A(t,n,e){const a=t.slice();return a[22]=n[e],a[23]=n,a[24]=e,a}function P(t){let n,e,v,S,w,b,N,$,O,T,j,x,C,H,B,R,D,I,L,V,J,U,W,q,A,P,F,G,M,Q,K,X,Y,Z,tt,nt,et="configurations"in t[0]&&z(t);return{c(){n=a("h4"),e=s("Scenario: "),v=s(t[2]),S=s(" Number of Containers: "),w=s(t[3]),b=s("."),N=o(),$=a("div"),O=a("div"),T=a("button"),j=s("Start Simulation"),x=o(),C=a("div"),H=a("button"),B=s("Stop Simulation"),R=o(),D=a("div"),I=a("button"),L=s("Reset WS Connection"),V=o(),J=a("hr"),U=o(),W=a("section"),q=a("h3"),A=s("Application Logs"),P=o(),F=a("button"),G=s("Clear Logs"),M=o(),et&&et.c(),Q=o(),K=a("br"),X=o(),Y=a("hr"),this.h()},l(a){n=r(a,"H4",{});var s=c(n);e=i(s,"Scenario: "),v=i(s,t[2]),S=i(s," Number of Containers: "),w=i(s,t[3]),b=i(s,"."),s.forEach(l),N=u(a),$=r(a,"DIV",{class:!0});var o=c($);O=r(o,"DIV",{class:!0});var f=c(O);T=r(f,"BUTTON",{class:!0});var d=c(T);j=i(d,"Start Simulation"),d.forEach(l),f.forEach(l),x=u(o),C=r(o,"DIV",{class:!0});var m=c(C);H=r(m,"BUTTON",{class:!0});var h=c(H);B=i(h,"Stop Simulation"),h.forEach(l),m.forEach(l),R=u(o),D=r(o,"DIV",{class:!0});var g=c(D);I=r(g,"BUTTON",{class:!0});var p=c(I);L=i(p,"Reset WS Connection"),p.forEach(l),g.forEach(l),o.forEach(l),V=u(a),J=r(a,"HR",{class:!0}),U=u(a),W=r(a,"SECTION",{class:!0});var k=c(W);q=r(k,"H3",{});var E=c(q);A=i(E,"Application Logs"),E.forEach(l),k.forEach(l),P=u(a),F=r(a,"BUTTON",{class:!0});var y=c(F);G=i(y,"Clear Logs"),y.forEach(l),M=u(a),et&&et.l(a),Q=u(a),K=r(a,"BR",{}),X=u(a),Y=r(a,"HR",{class:!0}),this.h()},h(){f(T,"class","w3-col w3-input w3-border"),f(O,"class","w3-third"),f(H,"class","w3-col w3-input w3-border"),f(C,"class","w3-third"),f(I,"class","w3-col w3-input w3-border"),f(D,"class","w3-third"),f($,"class","w3-row w3-section"),f(J,"class","svelte-drd2kv"),f(W,"class","page-headline"),f(F,"class","w3-col w3-input w3-border w3-button"),f(Y,"class","svelte-drd2kv")},m(a,s){d(a,n,s),m(n,e),m(n,v),m(n,S),m(n,w),m(n,b),d(a,N,s),d(a,$,s),m($,O),m(O,T),m(T,j),m($,x),m($,C),m(C,H),m(H,B),m($,R),m($,D),m(D,I),m(I,L),d(a,V,s),d(a,J,s),d(a,U,s),d(a,W,s),m(W,q),m(q,A),d(a,P,s),d(a,F,s),m(F,G),d(a,M,s),et&&et.m(a,s),d(a,Q,s),d(a,K,s),d(a,X,s),d(a,Y,s),Z=!0,tt||(nt=[h(T,"click",t[8]),h(H,"click",t[9]),h(I,"click",t[10]),h(F,"click",t[5])],tt=!0)},p(t,n){(!Z||4&n)&&g(v,t[2]),(!Z||8&n)&&g(w,t[3]),"configurations"in t[0]?et?(et.p(t,n),1&n&&p(et,1)):(et=z(t),et.c(),p(et,1),et.m(Q.parentNode,Q)):et&&(_(),k(et,1,1,(()=>{et=null})),E())},i(t){Z||(p(et),Z=!0)},o(t){k(et),Z=!1},d(t){t&&l(n),t&&l(N),t&&l($),t&&l(V),t&&l(J),t&&l(U),t&&l(W),t&&l(P),t&&l(F),t&&l(M),et&&et.d(t),t&&l(Q),t&&l(K),t&&l(X),t&&l(Y),tt=!1,y(nt)}}}function z(t){let n,e,a=t[0].configurations.length>0&&F(t);return{c(){a&&a.c(),n=v()},l(t){a&&a.l(t),n=v()},m(t,s){a&&a.m(t,s),d(t,n,s),e=!0},p(t,e){t[0].configurations.length>0?a?(a.p(t,e),1&e&&p(a,1)):(a=F(t),a.c(),p(a,1),a.m(n.parentNode,n)):a&&(_(),k(a,1,1,(()=>{a=null})),E())},i(t){e||(p(a),e=!0)},o(t){k(a),e=!1},d(t){a&&a.d(t),t&&l(n)}}}function F(t){let n,e,a=t[0].configurations,s=[];for(let r=0;r<a.length;r+=1)s[r]=K(A(t,a,r));const o=t=>k(s[t],1,1,(()=>{s[t]=null}));return{c(){for(let t=0;t<s.length;t+=1)s[t].c();n=v()},l(t){for(let n=0;n<s.length;n+=1)s[n].l(t);n=v()},m(t,a){for(let n=0;n<s.length;n+=1)s[n].m(t,a);d(t,n,a),e=!0},p(t,e){if(17&e){let r;for(a=t[0].configurations,r=0;r<a.length;r+=1){const o=A(t,a,r);s[r]?(s[r].p(o,e),p(s[r],1)):(s[r]=K(o),s[r].c(),p(s[r],1),s[r].m(n.parentNode,n))}for(_(),r=a.length;r<s.length;r+=1)o(r);E()}},i(t){if(!e){for(let t=0;t<a.length;t+=1)p(s[t]);e=!0}},o(t){s=s.filter(Boolean);for(let n=0;n<s.length;n+=1)k(s[n]);e=!1},d(t){O(s,t),t&&l(n)}}}function G(t){let n,e,a=t[24].toString()in t[4],s=a&&M(t);return{c(){s&&s.c(),n=v()},l(t){s&&s.l(t),n=v()},m(t,a){s&&s.m(t,a),d(t,n,a),e=!0},p(t,e){16&e&&(a=t[24].toString()in t[4]),a?s?(s.p(t,e),16&e&&p(s,1)):(s=M(t),s.c(),p(s,1),s.m(n.parentNode,n)):s&&(_(),k(s,1,1,(()=>{s=null})),E())},i(t){e||(p(s),e=!0)},o(t){k(s),e=!1},d(t){s&&s.d(t),t&&l(n)}}}function M(t){let n,e,a=t[4][t[24].toString()].length>0,s=a&&Q(t);return{c(){s&&s.c(),n=v()},l(t){s&&s.l(t),n=v()},m(t,a){s&&s.m(t,a),d(t,n,a),e=!0},p(t,e){16&e&&(a=t[4][t[24].toString()].length>0),a?s?(s.p(t,e),16&e&&p(s,1)):(s=Q(t),s.c(),p(s,1),s.m(n.parentNode,n)):s&&(_(),k(s,1,1,(()=>{s=null})),E())},i(t){e||(p(s),e=!0)},o(t){k(s),e=!1},d(t){s&&s.d(t),t&&l(n)}}}function Q(t){let n,e,f,h,v,E,O,y=t[22].container_info.name+"";function T(n){t[11](n,t[24])}let j={title:t[22].container_info.name,headers:Object.keys(t[4][t[24].toString()][0])};return void 0!==t[4][t[24].toString()]&&(j.data=t[4][t[24].toString()]),h=new D({props:j}),B.push((()=>R(h,"data",T))),{c(){n=a("h5"),e=s(y),f=o(),S(h.$$.fragment),E=o()},l(t){n=r(t,"H5",{});var a=c(n);e=i(a,y),a.forEach(l),f=u(t),w(h.$$.fragment,t),E=u(t)},m(t,a){d(t,n,a),m(n,e),d(t,f,a),b(h,t,a),d(t,E,a),O=!0},p(n,a){t=n,(!O||1&a)&&y!==(y=t[22].container_info.name+"")&&g(e,y);const s={};1&a&&(s.title=t[22].container_info.name),16&a&&(s.headers=Object.keys(t[4][t[24].toString()][0])),!v&&16&a&&(v=!0,s.data=t[4][t[24].toString()],N((()=>v=!1))),h.$set(s)},i(t){O||(p(h.$$.fragment,t),O=!0)},o(t){k(h.$$.fragment,t),O=!1},d(t){t&&l(n),t&&l(f),$(h,t),t&&l(E)}}}function K(t){let n,e,a=Object.keys(t[4]).length>0,s=a&&G(t);return{c(){s&&s.c(),n=v()},l(t){s&&s.l(t),n=v()},m(t,a){s&&s.m(t,a),d(t,n,a),e=!0},p(t,e){16&e&&(a=Object.keys(t[4]).length>0),a?s?(s.p(t,e),16&e&&p(s,1)):(s=G(t),s.c(),p(s,1),s.m(n.parentNode,n)):s&&(_(),k(s,1,1,(()=>{s=null})),E())},i(t){e||(p(s),e=!0)},o(t){k(s),e=!1},d(t){s&&s.d(t),t&&l(n)}}}function X(t){return{c:T,l:T,m:T,d:T}}function Y(t){return{c:T,l:T,m:T,d:T}}function Z(t){let n,e,h,g,N,O,y,T,C,H,B,R,D,L,V,J;e=new I({});let U="Communication"==t[1]&&P(t),W="Static"==t[1]&&X(),q="Driving Simulation"==t[1]&&Y();return{c(){n=o(),S(e.$$.fragment),h=o(),g=a("hr"),N=o(),O=a("div"),y=a("h1"),T=a("b"),C=s("Simulation"),H=o(),B=a("hr"),R=o(),U&&U.c(),D=o(),W&&W.c(),L=o(),q&&q.c(),V=v(),this.h()},l(t){j('[data-svelte="svelte-1smsifb"]',document.head).forEach(l),n=u(t),w(e.$$.fragment,t),h=u(t),g=r(t,"HR",{class:!0}),N=u(t),O=r(t,"DIV",{class:!0});var a=c(O);y=r(a,"H1",{class:!0,style:!0});var s=c(y);T=r(s,"B",{});var o=c(T);C=i(o,"Simulation"),o.forEach(l),s.forEach(l),a.forEach(l),H=u(t),B=r(t,"HR",{class:!0}),R=u(t),U&&U.l(t),D=u(t),W&&W.l(t),L=u(t),q&&q.l(t),V=v(),this.h()},h(){document.title="Simulation",f(g,"class","svelte-drd2kv"),f(y,"class","w3-text-yellow"),x(y,"text-shadow","1px 1px 0 #444"),f(O,"class","w3-panel w3-blue"),f(B,"class","svelte-drd2kv")},m(t,a){d(t,n,a),b(e,t,a),d(t,h,a),d(t,g,a),d(t,N,a),d(t,O,a),m(O,y),m(y,T),m(T,C),d(t,H,a),d(t,B,a),d(t,R,a),U&&U.m(t,a),d(t,D,a),W&&W.m(t,a),d(t,L,a),q&&q.m(t,a),d(t,V,a),J=!0},p(t,[n]){"Communication"==t[1]?U?(U.p(t,n),2&n&&p(U,1)):(U=P(t),U.c(),p(U,1),U.m(D.parentNode,D)):U&&(_(),k(U,1,1,(()=>{U=null})),E()),"Static"==t[1]?W||(W=X(),W.c(),W.m(L.parentNode,L)):W&&(W.d(1),W=null),"Driving Simulation"==t[1]?q||(q=Y(),q.c(),q.m(V.parentNode,V)):q&&(q.d(1),q=null)},i(t){J||(p(e.$$.fragment,t),p(U),J=!0)},o(t){k(e.$$.fragment,t),k(U),J=!1},d(t){t&&l(n),$(e,t),t&&l(h),t&&l(g),t&&l(N),t&&l(O),t&&l(H),t&&l(B),t&&l(R),U&&U.d(t),t&&l(D),W&&W.d(t),t&&l(L),q&&q.d(t),t&&l(V)}}}function tt(t,n,e){let a=[],s={},o="";const r=U.subscribe((t=>{a=t})),c=W.subscribe((t=>{e(0,s=t)})),i=q.subscribe((t=>{e(1,o=t)}));let l=[];C((()=>{r(),c(),i();for(let t=0;t<l.length;t++)l[t].close()}));let u="Please create and select a scenario before starting the simulation.",f=!1,d=0,m=[],h={};function g(){for(const[t,n]of Object.entries(h))e(4,h[t]=[],h)}async function p(t){if(!f)return void V.danger("please create and activate a scenario first.");"start"==t&&g(),J("/simulation","POST",{command:t,configs:s},(function(t){t.data&&(V.success("simulation started."),console.log("response of simulation",t.data))}))}function v(){for(var t=0;t<l.length;t++)ws=l[t],ws.close()}l=[],H((async()=>{let t="";for(let n=0;n<a.length;n++)a[n].activated&&(e(2,u=a[n].name),f=!0,t="/api/db1/scenario_configurations/ref-"+a[n]._id);!function(t,n){L(t,(function(t){let e=JSON.parse(t.response);e.data&&e.data.length>0&&(W.set(e.data[0]),n())}))}(t,(function(){if("Communication"==s.type){"configurations"in s&&e(3,d=s.configurations.length);for(var t=0;t<d;t++){e(4,h[t.toString()]=[],h);let n="ws://localhost:8000/simulation/ws/"+t.toString(),a=new WebSocket(n);a.onopen=function(){window.console.log("Successfully connected to the echo websocket server...")},a.onmessage=function(t){let n=JSON.parse(t.data);console.log(n,"printing JSON now");let a=n.client_index,s=JSON.parse(n.data);"status"in s?m[a]=s.status:e(4,h[a]=[...h[a],s],h)},l.push(a)}}}))}));return[s,o,u,d,h,g,p,v,()=>p("start"),()=>p("stop"),()=>v(),function(n,a){t.$$.not_equal(h[a.toString()],n)&&(h[a.toString()]=n,e(4,h))}]}export default class extends t{constructor(t){super(),n(this,t,tt,Z,e,{})}}
