import{S as s,i as t,s as a,l as o,f as n,v as e,j as l,k as r,m as c,n as i,o as f,a5 as u,r as d,w as g,d as h,u as m,M as p,e as w,t as v,L as b,c as S,a as k,g as $,b as E,N,F as O,G as j,h as T,Q as x,R as y,z as B,B as H,a3 as _,a4 as R}from"../../chunks/vendor-5cf7a4b5.js";import{T as C}from"../../chunks/index-a1695e4a.js";import{T as I,n as L,a as D}from"../../chunks/requests-f597ce78.js";import{s as V,a as U}from"../../chunks/store-f8ef346b.js";function q(s,t,a){const o=s.slice();return o[17]=t[a],o[18]=t,o[19]=a,o}function A(s){let t,a,l=s[0].configurations.length>0&&J(s);return{c(){l&&l.c(),t=o()},l(s){l&&l.l(s),t=o()},m(s,o){l&&l.m(s,o),n(s,t,o),a=!0},p(s,a){s[0].configurations.length>0?l?(l.p(s,a),1&a&&e(l,1)):(l=J(s),l.c(),e(l,1),l.m(t.parentNode,t)):l&&(H(),d(l,1,1,(()=>{l=null})),m())},i(s){a||(e(l),a=!0)},o(s){d(l),a=!1},d(s){l&&l.d(s),s&&h(t)}}}function J(s){let t,a,l=s[0].configurations,r=[];for(let o=0;o<l.length;o+=1)r[o]=z(q(s,l,o));const c=s=>d(r[s],1,1,(()=>{r[s]=null}));return{c(){for(let s=0;s<r.length;s+=1)r[s].c();t=o()},l(s){for(let t=0;t<r.length;t+=1)r[t].l(s);t=o()},m(s,o){for(let t=0;t<r.length;t+=1)r[t].m(s,o);n(s,t,o),a=!0},p(s,a){if(9&a){let o;for(l=s[0].configurations,o=0;o<l.length;o+=1){const n=q(s,l,o);r[o]?(r[o].p(n,a),e(r[o],1)):(r[o]=z(n),r[o].c(),e(r[o],1),r[o].m(t.parentNode,t))}for(H(),o=l.length;o<r.length;o+=1)c(o);m()}},i(s){if(!a){for(let s=0;s<l.length;s+=1)e(r[s]);a=!0}},o(s){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)d(r[t]);a=!1},d(s){p(r,s),s&&h(t)}}}function P(s){let t,a,o,m;function p(t){s[8](t,s[19])}let w={title:s[17].container_info.name,headers:Object.keys(s[3][s[19]])};return void 0!==s[3][s[19]]&&(w.data=s[3][s[19]]),t=new C({props:w}),_.push((()=>R(t,"data",p))),{c(){l(t.$$.fragment),o=r()},l(s){c(t.$$.fragment,s),o=i(s)},m(s,a){f(t,s,a),n(s,o,a),m=!0},p(o,n){s=o;const e={};1&n&&(e.title=s[17].container_info.name),8&n&&(e.headers=Object.keys(s[3][s[19]])),!a&&8&n&&(a=!0,e.data=s[3][s[19]],u((()=>a=!1))),t.$set(e)},i(s){m||(e(t.$$.fragment,s),m=!0)},o(s){d(t.$$.fragment,s),m=!1},d(s){g(t,s),s&&h(o)}}}function z(s){let t,a,l=Object.keys(s[3]).length>0,r=l&&P(s);return{c(){r&&r.c(),t=o()},l(s){r&&r.l(s),t=o()},m(s,o){r&&r.m(s,o),n(s,t,o),a=!0},p(s,a){8&a&&(l=Object.keys(s[3]).length>0),l?r?(r.p(s,a),8&a&&e(r,1)):(r=P(s),r.c(),e(r,1),r.m(t.parentNode,t)):r&&(H(),d(r,1,1,(()=>{r=null})),m())},i(s){a||(e(r),a=!0)},o(s){d(r),a=!1},d(s){r&&r.d(s),s&&h(t)}}}function F(s){let t,a,o,u,p,y,B,_,R,C,L,D,V,U,q,J,P,z,F,G,M,Q,W,K,X,Y,Z,ss,ts,as,os,ns,es,ls,rs,cs,is,fs,us,ds,gs,hs,ms,ps;a=new I({});let ws="configurations"in s[0]&&A(s);return{c(){t=r(),l(a.$$.fragment),o=r(),u=w("hr"),p=r(),y=w("div"),B=w("h1"),_=w("b"),R=v("Simulation"),C=r(),L=w("hr"),D=r(),V=w("h4"),U=v("Scenario: "),q=v(s[1]),J=v(" Number of Containers: "),P=v(s[2]),z=v("."),F=r(),G=w("div"),M=w("div"),Q=w("button"),W=v("Start Simulation"),K=r(),X=w("div"),Y=w("button"),Z=v("Stop Simulation"),ss=r(),ts=w("hr"),as=r(),os=w("section"),ns=w("h3"),es=v("Application Logs"),ls=r(),rs=w("button"),cs=v("Clear Logs"),is=r(),ws&&ws.c(),fs=r(),us=w("br"),ds=r(),gs=w("hr"),this.h()},l(n){b('[data-svelte="svelte-1smsifb"]',document.head).forEach(h),t=i(n),c(a.$$.fragment,n),o=i(n),u=S(n,"HR",{class:!0}),p=i(n),y=S(n,"DIV",{class:!0});var e=k(y);B=S(e,"H1",{class:!0,style:!0});var l=k(B);_=S(l,"B",{});var r=k(_);R=$(r,"Simulation"),r.forEach(h),l.forEach(h),e.forEach(h),C=i(n),L=S(n,"HR",{class:!0}),D=i(n),V=S(n,"H4",{});var f=k(V);U=$(f,"Scenario: "),q=$(f,s[1]),J=$(f," Number of Containers: "),P=$(f,s[2]),z=$(f,"."),f.forEach(h),F=i(n),G=S(n,"DIV",{class:!0});var d=k(G);M=S(d,"DIV",{class:!0});var g=k(M);Q=S(g,"BUTTON",{class:!0});var m=k(Q);W=$(m,"Start Simulation"),m.forEach(h),g.forEach(h),K=i(d),X=S(d,"DIV",{class:!0});var w=k(X);Y=S(w,"BUTTON",{class:!0});var v=k(Y);Z=$(v,"Stop Simulation"),v.forEach(h),w.forEach(h),d.forEach(h),ss=i(n),ts=S(n,"HR",{class:!0}),as=i(n),os=S(n,"SECTION",{class:!0});var E=k(os);ns=S(E,"H3",{});var N=k(ns);es=$(N,"Application Logs"),N.forEach(h),E.forEach(h),ls=i(n),rs=S(n,"BUTTON",{class:!0});var O=k(rs);cs=$(O,"Clear Logs"),O.forEach(h),is=i(n),ws&&ws.l(n),fs=i(n),us=S(n,"BR",{}),ds=i(n),gs=S(n,"HR",{class:!0}),this.h()},h(){document.title="Simulation",E(u,"class","svelte-drd2kv"),E(B,"class","w3-text-yellow"),N(B,"text-shadow","1px 1px 0 #444"),E(y,"class","w3-panel w3-blue"),E(L,"class","svelte-drd2kv"),E(Q,"class","w3-col w3-input w3-border w3-margin"),E(M,"class","w3-half"),E(Y,"class","w3-col w3-input w3-border w3-margin"),E(X,"class","w3-half"),E(G,"class","w3-row w3-section"),E(ts,"class","svelte-drd2kv"),E(os,"class","page-headline"),E(rs,"class","w3-col w3-input w3-border w3-button"),E(gs,"class","svelte-drd2kv")},m(e,l){n(e,t,l),f(a,e,l),n(e,o,l),n(e,u,l),n(e,p,l),n(e,y,l),O(y,B),O(B,_),O(_,R),n(e,C,l),n(e,L,l),n(e,D,l),n(e,V,l),O(V,U),O(V,q),O(V,J),O(V,P),O(V,z),n(e,F,l),n(e,G,l),O(G,M),O(M,Q),O(Q,W),O(G,K),O(G,X),O(X,Y),O(Y,Z),n(e,ss,l),n(e,ts,l),n(e,as,l),n(e,os,l),O(os,ns),O(ns,es),n(e,ls,l),n(e,rs,l),O(rs,cs),n(e,is,l),ws&&ws.m(e,l),n(e,fs,l),n(e,us,l),n(e,ds,l),n(e,gs,l),hs=!0,ms||(ps=[j(Q,"click",s[6]),j(Y,"click",s[7]),j(rs,"click",s[4])],ms=!0)},p(s,[t]){(!hs||2&t)&&T(q,s[1]),(!hs||4&t)&&T(P,s[2]),"configurations"in s[0]?ws?(ws.p(s,t),1&t&&e(ws,1)):(ws=A(s),ws.c(),e(ws,1),ws.m(fs.parentNode,fs)):ws&&(H(),d(ws,1,1,(()=>{ws=null})),m())},i(s){hs||(e(a.$$.fragment,s),e(ws),hs=!0)},o(s){d(a.$$.fragment,s),d(ws),hs=!1},d(s){s&&h(t),g(a,s),s&&h(o),s&&h(u),s&&h(p),s&&h(y),s&&h(C),s&&h(L),s&&h(D),s&&h(V),s&&h(F),s&&h(G),s&&h(ss),s&&h(ts),s&&h(as),s&&h(os),s&&h(ls),s&&h(rs),s&&h(is),ws&&ws.d(s),s&&h(fs),s&&h(us),s&&h(ds),s&&h(gs),ms=!1,x(ps)}}}function G(s,t,a){let o=[],n={};const e=V.subscribe((s=>{o=s})),l=U.subscribe((s=>{a(0,n=s)}));y((()=>{e(),l()}));let r="Please create and select a scenario before starting the simulation.",c=!1,i=0,f=[],u=[],d={};function g(){for(const[s,t]of Object.entries(d))a(3,d[s]=[],d)}async function h(s){if(!c)return void L.danger("please create and activate a scenario first.");g(),console.log("start or stop simulation"),D("/simulation","POST",{command:s,configs:n},(function(s){s.data&&console.log("response of start simulation",s.data)}))}B((async()=>{for(let t=0;t<o.length;t++)o[t].activated&&(a(1,r=o[t].name),c=!0,a(3,d[t.toString()]=[],d));"configurations"in n&&a(2,i=n.configurations.length),console.log("scenarios",o),console.log("scenario_configurations",n),f=[];for(var s=0;s<i;s++){let t=n.configurations[s].container_info.name,a=n.configurations[s].container_info.ports.split(",")[0].split("/")[0];console.log("sending to controller websocket: index",s,"name",t,"port",a);let o="ws://localhost:8000/simulation/ws/"+t+"/"+a+"/"+s.toString();console.log("ws url:",o);let e=new WebSocket(o);e.onopen=function(){window.console.log("Successfully connected to the echo websocket server...")},e.onmessage=function(s){window.console.log(s,"received ws message");let t=JSON.parse(s.data);console.log(t,"printing JSON now");let a=t.client_index,o=t.data;"status"in o&&(u[a]=o.status),"data"in o&&d[a].push(o.data),console.log(d)},f.push(e)}}));return[n,r,i,d,g,h,()=>h("start"),()=>h("stop"),function(t,o){s.$$.not_equal(d[o],t)&&(d[o]=t,a(3,d))}]}export default class extends s{constructor(s){super(),t(this,s,G,F,a,{})}}
